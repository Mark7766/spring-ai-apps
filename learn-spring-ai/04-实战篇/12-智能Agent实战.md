# ç¬¬12æœŸï¼šæ™ºèƒ½Agentå®æˆ˜ - æ‰“é€ è‡ªåŠ¨åŒ–å†…å®¹ç¼–è¾‘åŠ©æ‰‹

## ğŸ“Œ æœ¬æœŸæ¦‚è¿°

**æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªèƒ½è‡ªä¸»è¿è¡Œçš„æ™ºèƒ½Agentï¼Ÿ**

æ™ºèƒ½Agentæ˜¯AIåº”ç”¨çš„é«˜çº§å½¢æ€ï¼Œå®ƒèƒ½å¤Ÿè‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åˆ¶å®šè®¡åˆ’å¹¶æ‰§è¡Œä»»åŠ¡ã€‚æœ¬æœŸå°†å®æˆ˜ä¸€ä¸ªå®Œæ•´çš„æ–°é—»é‡‡é›†ä¸å†…å®¹æ€»ç»“Agentâ€”â€”Newtonï¼Œå®ƒæ¯6å°æ—¶è‡ªåŠ¨æŠ“å–Hacker Newsçƒ­é—¨æŠ€æœ¯æ–‡ç« ï¼Œä½¿ç”¨AIè¿›è¡Œç­›é€‰ã€ç¿»è¯‘ã€æ€»ç»“ï¼Œå¹¶é€šè¿‡é‚®ä»¶æ¨é€ï¼Œå®ç°å®Œå…¨è‡ªåŠ¨åŒ–çš„å†…å®¹è¿è¥æµç¨‹ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æœŸå­¦ä¹ åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… ç†è§£æ™ºèƒ½Agentçš„æ ¸å¿ƒæ¶æ„å’Œå·¥ä½œåŸç†
- âœ… å®ç°å¤šæ•°æ®æºçš„å†…å®¹é‡‡é›†ç­–ç•¥
- âœ… ä½¿ç”¨AIè¿›è¡Œå†…å®¹ç­›é€‰å’Œæ€»ç»“
- âœ… æ„å»ºè‡ªåŠ¨åŒ–ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ
- âœ… é›†æˆé‚®ä»¶æ¨é€åŠŸèƒ½
- âœ… å®ç°Agentçš„ç›‘æ§ä¸æ—¥å¿—ç®¡ç†

## ğŸ“š å†…å®¹å¤§çº²

### 1. æ™ºèƒ½Agentæ¶æ„è®¾è®¡

### 2. æ–°é—»é‡‡é›†å¼•æ“å®ç°

### 3. AIå†…å®¹ç­›é€‰ä¸æ€»ç»“

### 4. å®šæ—¶ä»»åŠ¡è°ƒåº¦

### 5. é‚®ä»¶æ¨é€é›†æˆ

### 6. ç›‘æ§ä¸æ—¥å¿—ç®¡ç†

---

## 1. æ™ºèƒ½Agentæ¶æ„è®¾è®¡

### 1.1 ä»€ä¹ˆæ˜¯æ™ºèƒ½Agentï¼Ÿ

**æ™ºèƒ½Agent** æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè‡ªä¸»æ„ŸçŸ¥ã€å†³ç­–å’Œæ‰§è¡Œçš„ç¨‹åºå®ä½“ã€‚

```
ä¼ ç»Ÿåº”ç”¨ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨å¤„ç† â†’ è¿”å›ç»“æœ

æ™ºèƒ½Agentï¼š
ç¯å¢ƒæ„ŸçŸ¥ â†’ è‡ªä¸»å†³ç­– â†’ è‡ªåŠ¨æ‰§è¡Œ â†’ æŒç»­ç›‘æ§
   â†“          â†“          â†“          â†“
å®šæ—¶è§¦å‘   AIç­›é€‰     å¤šæ­¥æ“ä½œ    çŠ¶æ€è®°å½•
```

### 1.2 Newton Agentæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Newton Agent                â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Scheduler (å®šæ—¶è°ƒåº¦å™¨)     â”‚    â”‚
â”‚  â”‚  - æ¯6å°æ—¶è§¦å‘ä¸€æ¬¡          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  HackerNewsProcessor        â”‚    â”‚
â”‚  â”‚  - è·å–çƒ­é—¨æ–°é—»åˆ—è¡¨         â”‚    â”‚
â”‚  â”‚  - è¿‡æ»¤å·²è¯»æ–°é—»             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  StoryProcessor (AIå¤„ç†)   â”‚    â”‚
â”‚  â”‚  - å†…å®¹ç­›é€‰ï¼ˆAIè¯†åˆ«ï¼‰       â”‚    â”‚
â”‚  â”‚  - å†…å®¹ç¿»è¯‘                 â”‚    â”‚
â”‚  â”‚  - å†…å®¹æ€»ç»“ï¼ˆAIç”Ÿæˆï¼‰       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  EmailSender (æ¨é€)        â”‚    â”‚
â”‚  â”‚  - æ ¼å¼åŒ–é‚®ä»¶               â”‚    â”‚
â”‚  â”‚  - å‘é€åˆ°è®¢é˜…è€…             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  DatabaseHelper (çŠ¶æ€)     â”‚    â”‚
â”‚  â”‚  - SQLiteå­˜å‚¨å·²è¯»çŠ¶æ€       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 Agentå·¥ä½œæµç¨‹

```
ã€æ¯6å°æ—¶è§¦å‘ã€‘
    â†“
1. è·å–HN Top 50æ–‡ç« 
    â†“
2. è¿‡æ»¤å·²è¯»æ–‡ç« ï¼ˆSQLiteå»é‡ï¼‰
    â†“
3. è¿‡æ»¤3å¤©å†…çš„æ–‡ç« 
    â†“
4. AIç­›é€‰ï¼šåªä¿ç•™AI/è½¯ä»¶å¼€å‘ç›¸å…³
    â†“
5. ç¿»è¯‘æ ‡é¢˜ï¼šè‹±æ–‡â†’ä¸­æ–‡
    â†“
6. AIæ€»ç»“ï¼šç”Ÿæˆ100å­—æ‘˜è¦
    â†“
7. æ ¼å¼åŒ–é‚®ä»¶å†…å®¹
    â†“
8. å‘é€é‚®ä»¶æ¨é€
    â†“
9. è®°å½•åˆ°æœ¬åœ°æ–‡ä»¶
    â†“
ã€å®Œæˆï¼Œç­‰å¾…ä¸‹æ¬¡è§¦å‘ã€‘
```

---

## 2. æ–°é—»é‡‡é›†å¼•æ“å®ç°

ç°åœ¨å¼€å§‹æ„å»ºNewton Agentï¼

é¡¹ç›®ä»£ç ï¼š[https://github.com/Mark7766/spring-ai-apps/tree/main/newston](https://github.com/Mark7766/spring-ai-apps/tree/main/newston)

### 2.1 é¡¹ç›®ä¾èµ–é…ç½®

```xml
<!-- æ¥è‡ªï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/pom.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.4.0</version>
    </parent>
    
    <groupId>com.sandy</groupId>
    <artifactId>newston</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>Newton</name>
    <description>
        Your 24/7 tech sentinel curating Hacker News breakthroughs in code and AI, 
        delivering distilled intelligence every 6 hours with human-readable clarity.
    </description>
    
    <properties>
        <java.version>17</java.version>
        <spring-ai.version>1.0.0-M6</spring-ai.version>
        <spring-ai-alibaba.version>1.0.0-M5.1</spring-ai-alibaba.version>
    </properties>
    
    <dependencies>
        <!-- â­ Spring AI OpenAI -->
        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-openai-spring-boot-starter</artifactId>
            <version>1.0.0-M5</version>
        </dependency>
        
        <!-- â­ Spring AI Ollamaï¼ˆæœ¬åœ°æ¨¡å‹ï¼‰ -->
        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-ollama-spring-boot-starter</artifactId>
            <version>1.0.0-M5</version>
        </dependency>
        
        <!-- â­ Spring AI é˜¿é‡Œäº‘ï¼ˆé€šä¹‰åƒé—®ï¼‰ -->
        <dependency>
            <groupId>com.alibaba.cloud.ai</groupId>
            <artifactId>spring-ai-alibaba-starter</artifactId>
            <version>${spring-ai-alibaba.version}</version>
        </dependency>
        
        <!-- Spring Boot Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- â­ SQLiteæ•°æ®åº“ï¼ˆå­˜å‚¨å·²è¯»çŠ¶æ€ï¼‰ -->
        <dependency>
            <groupId>org.xerial</groupId>
            <artifactId>sqlite-jdbc</artifactId>
            <version>3.36.0.3</version>
        </dependency>
        
        <!-- â­ Jsoupï¼ˆHTMLè§£æï¼‰ -->
        <dependency>
            <groupId>org.jsoup</groupId>
            <artifactId>jsoup</artifactId>
            <version>1.16.1</version>
        </dependency>
        
        <!-- Gsonï¼ˆJSONå¤„ç†ï¼‰ -->
        <dependency>
            <groupId>com.google.code.gson</groupId>
            <artifactId>gson</artifactId>
            <version>2.12.0</version>
        </dependency>
        
        <!-- â­ JavaMailï¼ˆé‚®ä»¶å‘é€ï¼‰ -->
        <dependency>
            <groupId>com.sun.mail</groupId>
            <artifactId>javax.mail</artifactId>
            <version>1.6.2</version>
        </dependency>
    </dependencies>
</project>
```

**æ ¸å¿ƒä¾èµ–è¯´æ˜**ï¼š
1. **å¤šAIæ¨¡å‹æ”¯æŒ**ï¼šOpenAIã€Ollamaã€é˜¿é‡Œäº‘ï¼Œå¯çµæ´»åˆ‡æ¢
2. **SQLite**ï¼šè½»é‡çº§æ•°æ®åº“ï¼Œå­˜å‚¨å·²è¯»æ–‡ç« ID
3. **Jsoup**ï¼šè§£æHTMLå†…å®¹
4. **JavaMail**ï¼šå‘é€é‚®ä»¶æ¨é€

### 2.2 æ ¸å¿ƒå¤„ç†å™¨ï¼ˆç¬¬1/2éƒ¨åˆ†ï¼‰

åˆ›å»º`HackerNewsProcessor.java`ï¼š

```java
// æ¥è‡ªï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/src/main/java/com/sandy/newston/HackerNewsProcessor.javaï¼ˆç¬¬1éƒ¨åˆ†ï¼‰
package com.sandy.newston;

import com.google.gson.JsonObject;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

import java.io.FileWriter;
import java.io.IOException;
import java.sql.SQLException;
import java.time.*;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.List;

@Slf4j
@Component
public class HackerNewsProcessor {
    
    @Autowired
    private StoryProcessor storyProcessor;
    
    @Autowired
    private EmailSender emailSender;

    /**
     * â­ å®šæ—¶ä»»åŠ¡ï¼šæ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡
     * cronè¡¨è¾¾å¼ä»é…ç½®æ–‡ä»¶è¯»å–
     */
    @Scheduled(cron = "${sandy.newston.schedule}")
    public void process() {
        log.info("HackerNewsProcessor starts to process news.");
        
        try {
            // â­ Step 1: åˆå§‹åŒ–æ•°æ®åº“
            DatabaseHelper.initDB();
            Class.forName("org.sqlite.JDBC");
            log.info("Database is inited.");
            
            // â­ Step 2: è·å–HN Top 50æ–‡ç« 
            List<String> topStories = storyProcessor.getTopStories();
            log.info("topStories: {}", topStories.toString());
            
            // â­ Step 3: è¿‡æ»¤æ–°æ–‡ç« ï¼ˆå»é‡+æ—¶é—´è¿‡æ»¤ï¼‰
            List<JsonObject> newStories = getNewStories(topStories);
            log.info("newStories: {}", newStories.toString());
            
            if (newStories.isEmpty()) {
                log.info("No new story found.");
                return;
            }
            
            // â­ Step 4: AIç­›é€‰æ„Ÿå…´è¶£çš„æ–‡ç« 
            List<JsonObject> favouriteStories = storyProcessor.filterSoftwareTitles(newStories);
            
            // â­ Step 5: ç”Ÿæˆæ‘˜è¦
            List<String> summaries = summary(favouriteStories);
            
            // â­ Step 6: è®°å½•åˆ°æœ¬åœ°æ–‡ä»¶
            recordDateSummaries(summaries);
            
            // â­ Step 7: å‘é€é‚®ä»¶
            if (!summaries.isEmpty()) {
                emailSender.sendEmail(
                    "Hacker News " + DateTimeUtils.getCurrentTime(), 
                    String.join("\n", summaries)
                );
            }

        } catch (Exception e) {
            log.error("Main process failed: " + e.getMessage(), e);
        }
        
        log.info("HackerNewsProcessor has processed news completely.");
    }
```

ç»§ç»­å¤„ç†å™¨çš„è¾…åŠ©æ–¹æ³•ï¼š

```java
    // ç»§ç»­ï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/src/main/java/com/sandy/newston/HackerNewsProcessor.javaï¼ˆç¬¬2éƒ¨åˆ†ï¼‰
    
    /**
     * â­ è¿‡æ»¤æ–°æ–‡ç« ï¼ˆå»é‡+æ—¶é—´è¿‡æ»¤ï¼‰
     */
    private List<JsonObject> getNewStories(List<String> topStories) 
        throws SQLException, IOException {
        
        List<JsonObject> newStories = new ArrayList<>();
        ZonedDateTime threeDaysAgo = ZonedDateTime.now(ZoneOffset.UTC).minusDays(3);
        
        // åªå¤„ç†å‰50ç¯‡
        for (String storyId : topStories.subList(0, Math.min(50, topStories.size()))) {
            // â­ æ£€æŸ¥æ˜¯å¦å·²è¯»ï¼ˆSQLiteå»é‡ï¼‰
            if (!DatabaseHelper.keyExists(storyId)) {
                DatabaseHelper.setKey(storyId);
                
                // è·å–æ–‡ç« è¯¦æƒ…
                JsonObject detail = storyProcessor.getStoryDetails(storyId);
                long time = detail.get("time").getAsLong();
                Instant instant = Instant.ofEpochSecond(time);
                
                // â­ åªä¿ç•™3å¤©å†…çš„æ–‡ç« 
                if (instant.isAfter(threeDaysAgo.toInstant())) {
                    newStories.add(detail);
                }
            }
        }
        
        return newStories;
    }

    /**
     * â­ ç”Ÿæˆæ‘˜è¦ï¼ˆç¿»è¯‘+æ€»ç»“ï¼‰
     */
    private List<String> summary(List<JsonObject> favouriteStories) {
        List<String> summaries = new ArrayList<>();
        
        favouriteStories.forEach(detail -> {
            log.info("Processing detail: {}", detail.toString());
            
            if (detail.has("text")) {
                String title = detail.get("title").getAsString();
                String createDate = toDateStr(detail.get("time").getAsLong());
                int score = detail.get("score").getAsInt();
                int descendants = detail.get("descendants").getAsInt();
                String storyType = detail.get("type").getAsString();
                String text = detail.get("text").getAsString();
                String url = !detail.has("url") ? "NO URL" : detail.get("url").getAsString();
                
                try {
                    // â­ AIç¿»è¯‘æ ‡é¢˜
                    String titleZh = storyProcessor.translateToChinese(title);
                    
                    // â­ AIç”Ÿæˆæ‘˜è¦
                    String summary = storyProcessor.generateSummary(text);
                    
                    // æ ¼å¼åŒ–è¾“å‡º
                    summaries.add(String.format(
                        "%s:%d:%d:%s\n%s\n%s\n%s\n%s\n%s\n",
                        createDate, score, descendants, storyType,
                        title, titleZh, summary, url,
                        "-----------------------------"
                    ));
                } catch (IOException e) {
                    log.error("Translation error: {}", e.getMessage(), e);
                }
            }
        });
        
        return summaries;
    }

    /**
     * è®°å½•åˆ°æœ¬åœ°æ–‡ä»¶
     */
    private void recordDateSummaries(List<String> summaries) throws IOException {
        String filename = LocalDate.now().format(DateTimeFormatter.BASIC_ISO_DATE) + ".txt";
        try (FileWriter writer = new FileWriter(filename, true)) {
            for (String summary : summaries) {
                writer.write(summary + "\n");
            }
        }
    }

    /**
     * Unixæ—¶é—´æˆ³è½¬æ—¥æœŸå­—ç¬¦ä¸²
     */
    public static String toDateStr(long unixTimestamp) {
        Instant instant = Instant.ofEpochSecond(unixTimestamp);
        LocalDateTime localTime = LocalDateTime.ofInstant(instant, ZoneId.systemDefault());
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        return localTime.format(formatter);
    }
}
```

**æ ¸å¿ƒé€»è¾‘è§£æ**ï¼š

1. **@Scheduledæ³¨è§£**ï¼š
   ```java
   @Scheduled(cron = "${sandy.newston.schedule}")
   ```
   å®šæ—¶è§¦å‘ï¼Œcronè¡¨è¾¾å¼ä»é…ç½®è¯»å–ã€‚

2. **SQLiteå»é‡**ï¼š
   ```java
   if (!DatabaseHelper.keyExists(storyId)) {
       DatabaseHelper.setKey(storyId);
   ```
   é¿å…é‡å¤å¤„ç†åŒä¸€æ–‡ç« ã€‚

3. **æ—¶é—´è¿‡æ»¤**ï¼š
   ```java
   ZonedDateTime threeDaysAgo = ...
   if (instant.isAfter(threeDaysAgo.toInstant())) {
   ```
   åªå¤„ç†3å¤©å†…çš„æ–°é²œå†…å®¹ã€‚

---

## 3. AIå†…å®¹ç­›é€‰ä¸æ€»ç»“

### 3.1 Storyå¤„ç†å™¨ï¼ˆç¬¬1/3éƒ¨åˆ†ï¼‰

åˆ›å»º`StoryProcessor.java`ï¼š

```java
// æ¥è‡ªï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/src/main/java/com/sandy/newston/StoryProcessor.javaï¼ˆç¬¬1éƒ¨åˆ†ï¼‰
package com.sandy.newston;

import com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;
import com.google.gson.*;
import jakarta.annotation.PostConstruct;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;
import org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;
import org.springframework.ai.chat.memory.InMemoryChatMemory;
import org.springframework.ai.chat.messages.*;
import org.springframework.ai.chat.prompt.*;
import org.springframework.ai.ollama.api.OllamaModel;
import org.springframework.ai.ollama.api.OllamaOptions;
import org.springframework.ai.openai.OpenAiChatOptions;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.io.IOException;
import java.net.URLEncoder;
import java.util.*;

@Component
@Slf4j
public class StoryProcessor {
    
    private static final Gson gson = new Gson();
    private static final String DEFAULT_PROMPT = "ä½ æ˜¯ä¸€ä¸ªåšå­¦çš„æ™ºèƒ½èŠå¤©åŠ©æ‰‹ï¼Œè¯·æ ¹æ®ç”¨æˆ·æé—®å›ç­”ï¼";
    
    private ChatClient dashScopeChatClient;
    private final ChatClient.Builder chatClientBuilder;
    
    @Value("${sandy.newston.bl-mode}")
    private String model;
    
    @Value("${spring.ai.dashscope.chat.enabled}")
    private boolean dashscopeEnabled;
    
    @Value("${spring.ai.openai.chat.enabled}")
    private boolean openaiEnabled;
    
    @Value("${spring.ai.ollama.chat.enabled}")
    private boolean ollamaEnabled;

    public StoryProcessor(ChatClient.Builder chatClientBuilder) {
        this.chatClientBuilder = chatClientBuilder;
    }

    /**
     * â­ åˆå§‹åŒ–AIæ¨¡å‹ï¼ˆæ”¯æŒå¤šç§æ¨¡å‹ï¼‰
     */
    @PostConstruct
    public void init() {
        ChatOptions chatOptions = null;
        
        // â­ æ ¹æ®é…ç½®é€‰æ‹©AIæ¨¡å‹
        if (dashscopeEnabled) {
            chatOptions = DashScopeChatOptions.builder()
                .withModel(this.model)
                .withTopP(0.7)
                .build();
        } else if (openaiEnabled) {
            chatOptions = OpenAiChatOptions.builder()
                .model("deepseek-chat")
                .temperature(0.4)
                .build();
        } else if (ollamaEnabled) {
            chatOptions = OllamaOptions.builder()
                .model(OllamaModel.QWEN_2_5_7B)
                .temperature(0.4)
                .build();
        } else {
            throw new RuntimeException("No AI model configured");
        }

        log.info("chatOptions: {}", gson.toJson(chatOptions));
        
        // â­ æ„å»ºChatClient
        this.dashScopeChatClient = this.chatClientBuilder
            .defaultSystem(DEFAULT_PROMPT)
            .defaultAdvisors(
                new MessageChatMemoryAdvisor(new InMemoryChatMemory()),
                new SimpleLoggerAdvisor()
            )
            .defaultOptions(chatOptions)
            .build();
    }
```

ç»§ç»­Storyå¤„ç†å™¨çš„APIè°ƒç”¨æ–¹æ³•ï¼š

```java
    // ç»§ç»­ï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/src/main/java/com/sandy/newston/StoryProcessor.javaï¼ˆç¬¬2éƒ¨åˆ†ï¼‰
    
    /**
     * â­ è·å–HNçƒ­é—¨æ–‡ç« åˆ—è¡¨
     */
    public List<String> getTopStories() throws IOException {
        JsonArray topStories = HttpUtil.get(
            "https://hacker-news.firebaseio.com/v0/topstories.json", 
            JsonArray.class
        );
        
        List<String> result = new ArrayList<>();
        for (JsonElement el : topStories) {
            result.add(el.getAsString());
        }
        return result;
    }

    /**
     * â­ è·å–æ–‡ç« è¯¦æƒ…
     */
    public JsonObject getStoryDetails(String storyId) throws IOException {
        return HttpUtil.get(
            "https://hacker-news.firebaseio.com/v0/item/" + storyId + ".json", 
            JsonObject.class
        );
    }

    /**
     * â­ ç¿»è¯‘æ ‡é¢˜ï¼ˆä½¿ç”¨Googleç¿»è¯‘APIï¼‰
     */
    public String translateToChinese(String text) throws IOException {
        JsonArray response = HttpUtil.get(
            "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=zh-CN&dt=t&q=" 
            + URLEncoder.encode(text, "UTF-8"), 
            JsonArray.class
        );
        return response.get(0).getAsJsonArray()
            .get(0).getAsJsonArray()
            .get(0).getAsString();
    }
```

ç»§ç»­AIå†…å®¹å¤„ç†æ–¹æ³•ï¼š

```java
    // ç»§ç»­ï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/src/main/java/com/sandy/newston/StoryProcessor.javaï¼ˆç¬¬3éƒ¨åˆ†ï¼‰
    
    /**
     * â­ AIç”Ÿæˆæ‘˜è¦
     */
    public String generateSummary(String text) {
        String promptStr = "åŸºäº" + text + "ç”Ÿæˆ100å­—ä»¥å†…çš„ä¸­æ–‡æ‘˜è¦ï¼Œä¸éœ€è¦è‹±æ–‡æ‘˜è¦å’Œä¸­æ–‡æè¿°";
        
        List<Message> messages = new ArrayList<>();
        messages.add(new SystemMessage("ä½ ä¸€ä¸ªAIå’ŒITæŠ€æœ¯ä¸“å®¶ï¼Œä¹Ÿæ˜¯ITæŠ€æœ¯åšä¸»çš„åŠ©æ‰‹ã€‚"));
        messages.add(new UserMessage(promptStr));
        
        Prompt prompt = new Prompt(messages);
        log.info("generateSummary request: {}", gson.toJson(prompt));
        
        String content = dashScopeChatClient.prompt(prompt).call().content();
        log.info("generateSummary response: {}", content);
        
        return content;
    }

    /**
     * â­ AIç­›é€‰æŠ€æœ¯ç›¸å…³æ–‡ç« 
     */
    public List<JsonObject> filterSoftwareTitles(List<JsonObject> newStories) {
        // æ„å»ºIDå’ŒStoryçš„æ˜ å°„
        Map<String, JsonObject> idStoryMapping = new HashMap<>();
        StringBuilder titles = new StringBuilder();
        
        newStories.forEach(story -> {
            String id = story.get("id").getAsString();
            String title = story.get("title").getAsString();
            titles.append(title).append(" ").append(id).append("\n");
            idStoryMapping.put(id, story);
        });
        
        // â­ æ„å»ºAIç­›é€‰Prompt
        String promptStr = """
            ä»¥ä¸‹æ˜¯ä¸€äº›æ•…äº‹çš„æ ‡é¢˜ã€‚è¯·è¿‡æ»¤å‡ºä¸AIæˆ–è½¯ä»¶å¼€å‘ç›¸å…³çš„æ ‡é¢˜å’Œå¯¹åº”çš„ID,
            IDä¸è¦ç”¨æ‹¬å·æ‹¬èµ·æ¥,IDåé¢ä¸ç”¨æœ‰ç©ºæ ¼ï¼ŒIDåœ¨æ ‡é¢˜çš„åè¾¹ï¼Œå¦‚æ ‡é¢˜ IDï¼Œ
            å›å¤çš„å†…å®¹é‡Œåªä¿ç•™æ ‡é¢˜å’ŒIDï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„æ ‡é¢˜ï¼Œè¯·ç›´æ¥å›å¤æ²¡æœ‰ï¼Œ
            æ•…äº‹çš„æ ‡é¢˜:
            """ + titles.toString();
        
        List<Message> messages = new ArrayList<>();
        messages.add(new SystemMessage("ä½ ä¸€ä¸ªAIå’ŒITæŠ€æœ¯ä¸“å®¶ï¼Œä¹Ÿæ˜¯ITæŠ€æœ¯åšä¸»çš„åŠ©æ‰‹ã€‚"));
        messages.add(new UserMessage(promptStr));
        
        Prompt prompt = new Prompt(messages);
        log.info("filterSoftwareTitles request: {}", gson.toJson(prompt));
        
        String content = dashScopeChatClient.prompt(prompt).call().content();
        log.info("filterSoftwareTitles response: {}", content);
        
        // â­ è§£æAIè¿”å›çš„ç»“æœ
        String[] lines = content.split("\n");
        List<JsonObject> result = new ArrayList<>();
        
        for (String line : lines) {
            if (!line.trim().isEmpty()) {
                String[] parts = line.split(" ");
                if (parts.length > 0) {
                    String id = parts[parts.length - 1];
                    if (idStoryMapping.containsKey(id)) {
                        result.add(idStoryMapping.get(id));
                    } else {
                        log.info("Title[{}] has no story.", id);
                    }
                }
            }
        }
        
        return result;
    }
}
```

**AIå¤„ç†æ ¸å¿ƒé€»è¾‘**ï¼š

1. **AIç­›é€‰**ï¼š
   ```java
   filterSoftwareTitles(newStories)
   ```
   å°†æ‰€æœ‰æ ‡é¢˜å‘é€ç»™AIï¼Œè®©AIåˆ¤æ–­å“ªäº›æ˜¯æŠ€æœ¯ç›¸å…³ã€‚

2. **AIæ‘˜è¦**ï¼š
   ```java
   generateSummary(text)
   ```
   AIç”Ÿæˆ100å­—ä¸­æ–‡æ‘˜è¦ï¼Œæç‚¼æ ¸å¿ƒå†…å®¹ã€‚

3. **å¤šæ¨¡å‹æ”¯æŒ**ï¼š
   æ ¹æ®é…ç½®æ–‡ä»¶é€‰æ‹©ä½¿ç”¨é˜¿é‡Œäº‘ã€OpenAIè¿˜æ˜¯Ollamaã€‚

---

## 4. å®šæ—¶ä»»åŠ¡è°ƒåº¦

### 4.1 é…ç½®å®šæ—¶ä»»åŠ¡

åœ¨`application.yml`ä¸­é…ç½®ï¼š

```yaml
# å®šæ—¶ä»»åŠ¡cronè¡¨è¾¾å¼
sandy:
  newston:
    schedule: "0 0 0/6 * * ?"  # æ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡
    bl-mode: "qwen-plus"  # AIæ¨¡å‹
```

**cronè¡¨è¾¾å¼è§£æ**ï¼š
- `0 0 0/6 * * ?`
  - ç§’ï¼š0
  - åˆ†ï¼š0
  - æ—¶ï¼š0/6ï¼ˆæ¯6å°æ—¶ï¼‰
  - æ—¥ï¼š*ï¼ˆæ¯å¤©ï¼‰
  - æœˆï¼š*ï¼ˆæ¯æœˆï¼‰
  - å‘¨ï¼š?ï¼ˆä¸æŒ‡å®šï¼‰

### 4.2 å¯ç”¨å®šæ—¶ä»»åŠ¡

åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼š

```java
// æ¥è‡ªï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/src/main/java/com/sandy/newston/NewstonApplication.java
package com.sandy.newston;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.scheduling.annotation.EnableScheduling;

@SpringBootApplication
@EnableScheduling  // â­ å¯ç”¨å®šæ—¶ä»»åŠ¡
public class NewstonApplication {
    public static void main(String[] args) {
        SpringApplication.run(NewstonApplication.java, args);
    }
}
```

---

## 5. é‚®ä»¶æ¨é€é›†æˆ

### 5.1 é‚®ä»¶å‘é€å™¨

åˆ›å»º`EmailSender.java`ï¼š

```java
// æ¥è‡ªï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/src/main/java/com/sandy/newston/EmailSender.java
package com.sandy.newston;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import javax.mail.*;
import javax.mail.internet.*;
import java.util.Properties;

@Slf4j
@Component
public class EmailSender {
    
    @Value("${email.smtp.host}")
    private String smtpHost;
    
    @Value("${email.smtp.port}")
    private int smtpPort;
    
    @Value("${email.from}")
    private String from;
    
    @Value("${email.password}")
    private String password;
    
    @Value("${email.to}")
    private String to;

    /**
     * â­ å‘é€é‚®ä»¶
     */
    public void sendEmail(String subject, String body) {
        try {
            // â­ é…ç½®é‚®ä»¶æœåŠ¡å™¨
            Properties props = new Properties();
            props.put("mail.smtp.host", smtpHost);
            props.put("mail.smtp.port", smtpPort);
            props.put("mail.smtp.auth", "true");
            props.put("mail.smtp.starttls.enable", "true");
            
            // â­ åˆ›å»ºä¼šè¯
            Session session = Session.getInstance(props, new Authenticator() {
                @Override
                protected PasswordAuthentication getPasswordAuthentication() {
                    return new PasswordAuthentication(from, password);
                }
            });
            
            // â­ æ„å»ºé‚®ä»¶
            Message message = new MimeMessage(session);
            message.setFrom(new InternetAddress(from));
            message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(to));
            message.setSubject(subject);
            message.setText(body);
            
            // â­ å‘é€
            Transport.send(message);
            log.info("Email sent successfully to {}", to);
            
        } catch (MessagingException e) {
            log.error("Failed to send email: {}", e.getMessage(), e);
        }
    }
}
```

### 5.2 é‚®ä»¶é…ç½®

åœ¨`application.yml`ä¸­é…ç½®ï¼š

```yaml
email:
  smtp:
    host: smtp.gmail.com  # SMTPæœåŠ¡å™¨
    port: 587             # ç«¯å£
  from: your-email@gmail.com
  password: your-app-password  # åº”ç”¨ä¸“ç”¨å¯†ç 
  to: subscriber@example.com
```

---

## 6. ç›‘æ§ä¸æ—¥å¿—ç®¡ç†

### 6.1 SQLiteæ•°æ®åº“åŠ©æ‰‹

åˆ›å»º`DatabaseHelper.java`ï¼š

```java
// æ¥è‡ªï¼šhttps://github.com/Mark7766/spring-ai-apps/blob/main/newston/src/main/java/com/sandy/newston/DatabaseHelper.java
package com.sandy.newston;

import java.sql.*;

public class DatabaseHelper {
    
    private static final String DB_URL = "jdbc:sqlite:newston.db";

    /**
     * â­ åˆå§‹åŒ–æ•°æ®åº“
     */
    public static void initDB() throws SQLException {
        try (Connection conn = DriverManager.getConnection(DB_URL);
             Statement stmt = conn.createStatement()) {
            
            // åˆ›å»ºè¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            String sql = """
                CREATE TABLE IF NOT EXISTS seen_stories (
                    story_id TEXT PRIMARY KEY,
                    seen_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
                """;
            stmt.execute(sql);
        }
    }

    /**
     * â­ æ£€æŸ¥æ–‡ç« æ˜¯å¦å·²è¯»
     */
    public static boolean keyExists(String storyId) throws SQLException {
        try (Connection conn = DriverManager.getConnection(DB_URL);
             PreparedStatement pstmt = conn.prepareStatement(
                 "SELECT 1 FROM seen_stories WHERE story_id = ?")) {
            
            pstmt.setString(1, storyId);
            try (ResultSet rs = pstmt.executeQuery()) {
                return rs.next();
            }
        }
    }

    /**
     * â­ æ ‡è®°æ–‡ç« ä¸ºå·²è¯»
     */
    public static void setKey(String storyId) throws SQLException {
        try (Connection conn = DriverManager.getConnection(DB_URL);
             PreparedStatement pstmt = conn.prepareStatement(
                 "INSERT OR IGNORE INTO seen_stories (story_id) VALUES (?)")) {
            
            pstmt.setString(1, storyId);
            pstmt.executeUpdate();
        }
    }
}
```

### 6.2 æ—¥å¿—é…ç½®

é…ç½®`logback.xml`ï¼š

```xml
<configuration>
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/newston.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/newston.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <root level="INFO">
        <appender-ref ref="CONSOLE" />
        <appender-ref ref="FILE" />
    </root>
</configuration>
```

---

## ğŸ’» ç¤ºä¾‹ä»£ç 

å®Œæ•´é¡¹ç›®ä»£ç ï¼š[https://github.com/Mark7766/spring-ai-apps/tree/main/newston](https://github.com/Mark7766/spring-ai-apps/tree/main/newston)

**é¡¹ç›®ç»“æ„**ï¼š
```
newston/
â”œâ”€â”€ src/main/java/com/sandy/newston/
â”‚   â”œâ”€â”€ NewstonApplication.java          # å¯åŠ¨ç±»
â”‚   â”œâ”€â”€ HackerNewsProcessor.java         # ä¸»æµç¨‹å¤„ç†å™¨
â”‚   â”œâ”€â”€ StoryProcessor.java              # AIå†…å®¹å¤„ç†
â”‚   â”œâ”€â”€ EmailSender.java                 # é‚®ä»¶å‘é€
â”‚   â”œâ”€â”€ DatabaseHelper.java              # SQLiteåŠ©æ‰‹
â”‚   â”œâ”€â”€ HttpUtil.java                    # HTTPå·¥å…·
â”‚   â””â”€â”€ DateTimeUtils.java               # æ—¶é—´å·¥å…·
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml                  # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ logback.xml                      # æ—¥å¿—é…ç½®
â”œâ”€â”€ Dockerfile                           # Dockeré•œåƒ
â””â”€â”€ pom.xml
```

---

## ğŸ¤” æ€è€ƒé¢˜

1. **å¦‚ä½•è®©Agentåœ¨ä»»åŠ¡å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•å’Œæ¢å¤ï¼Ÿ**
   
   æç¤ºï¼šå¯ä»¥ä½¿ç”¨Spring Retryã€æ­»ä¿¡é˜Ÿåˆ—ã€çŠ¶æ€æœºç­‰æ–¹æ¡ˆã€‚

2. **å¤šä¸ªAgentå¦‚ä½•åä½œå®Œæˆå¤æ‚ä»»åŠ¡ï¼Ÿ**
   
   æç¤ºï¼šè€ƒè™‘æ¶ˆæ¯é˜Ÿåˆ—ã€äº‹ä»¶é©±åŠ¨ã€å¾®æœåŠ¡ç¼–æ’ç­‰æ¶æ„ã€‚

3. **å¦‚ä½•è¯„ä¼°Agentçš„å·¥ä½œè´¨é‡ï¼Ÿ**
   
   æç¤ºï¼šå¯ä»¥è®°å½•æˆåŠŸç‡ã€å“åº”æ—¶é—´ã€ç”¨æˆ·åé¦ˆç­‰æŒ‡æ ‡ã€‚

---

## ğŸ“– æ‹“å±•é˜…è¯»

- [Spring Schedulingæ–‡æ¡£](https://docs.spring.io/spring-framework/reference/integration/scheduling.html)
- [Hacker News API](https://github.com/HackerNews/API)
- [æ™ºèƒ½Agentè®¾è®¡æ¨¡å¼](https://arxiv.org/abs/2308.11432)
- [LangChain Agentæ–‡æ¡£](https://python.langchain.com/docs/modules/agents/)

---

## â­ï¸ ä¸‹æœŸé¢„å‘Š

æ­å–œä½ æŒæ¡äº†æ™ºèƒ½Agentå®æˆ˜ï¼ğŸ‰ ç°åœ¨ä½ å¯ä»¥æ„å»ºè‡ªåŠ¨åŒ–è¿è¡Œçš„AIåº”ç”¨äº†ã€‚

ä½†å•ä¸ªAgentè¿˜ä¸å¤Ÿï¼Œä¼ä¸šçº§åº”ç”¨éœ€è¦è€ƒè™‘æ›´å¤šï¼š
- â“ å¦‚ä½•æ”¯æ’‘ç™¾ä¸‡çº§å¹¶å‘ï¼Ÿ
- â“ å¦‚ä½•ä¿è¯99.99%çš„å¯ç”¨æ€§ï¼Ÿ
- â“ å¦‚ä½•è®¾è®¡å¯æ‰©å±•çš„RAGæ¶æ„ï¼Ÿ

**ä¸‹ä¸€æœŸæˆ‘ä»¬å°†å­¦ä¹ ä¼ä¸šçº§RAGç³»ç»Ÿæ¶æ„è®¾è®¡**ï¼Œä»æŠ€æœ¯é€‰å‹åˆ°é«˜å¯ç”¨éƒ¨ç½²ï¼Œæ„å»ºç”Ÿäº§çº§AIåº”ç”¨ï¼

**ä¸‹æœŸäº®ç‚¹**ï¼š
- ğŸ—ï¸ ä¼ä¸šçº§RAGæ¶æ„è®¾è®¡æ¨¡å¼
- ğŸš€ é«˜æ€§èƒ½å‘é‡æ£€ç´¢ä¼˜åŒ–
- ğŸ”„ åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡
- ğŸ“Š ç›‘æ§ä¸å¯è§‚æµ‹æ€§
- ğŸ›¡ï¸ å®‰å…¨ä¸æƒé™ç®¡ç†
- ğŸ’° æˆæœ¬ä¼˜åŒ–ç­–ç•¥

ä»å•æœºåˆ°é›†ç¾¤ï¼Œä»åŸå‹åˆ°ç”Ÿäº§ï¼Œè®©ä½ çš„AIåº”ç”¨çœŸæ­£è½åœ°ï¼

æ•¬è¯·æœŸå¾…ï¼

---

**æ›´æ–°æ—¥æœŸ**ï¼š2025å¹´12æœˆ3æ—¥  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ


